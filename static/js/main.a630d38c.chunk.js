(this["webpackJsonparound-react"]=this["webpackJsonparound-react"]||[]).push([[0],{29:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),c=n(18),i=n.n(c),r=(n(29),n(23)),o=n(2),l=n(3),u=n(8),p=n(19),d=n(20),j=function(e,t){return fetch(e,t).then((function(e){return e.ok?e.json():Promise.reject("Error ".concat(e.status))}))},b=new(function(){function e(t){var n=t.baseUrl,a=t.headers;Object(p.a)(this,e),this._baseUrl=n,this._headers=a}return Object(d.a)(e,[{key:"getInitialCards",value:function(){return j("".concat(this._baseUrl,"/cards"),{headers:this._headers})}},{key:"getUserInfo",value:function(){return j("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}},{key:"editUserInfo",value:function(e){var t=e.name,n=e.about;return j("".concat(this._baseUrl,"/users/me"),{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:n})})}},{key:"uploadUserAvatar",value:function(e){return j("".concat(this._baseUrl,"/users/me/avatar"),{headers:this._headers,method:"PATCH",body:JSON.stringify(e)})}},{key:"postNewCard",value:function(e){return j("".concat(this._baseUrl,"/cards"),{headers:this._headers,method:"POST",body:JSON.stringify(e)})}},{key:"deleteCard",value:function(e){return j("".concat(this._baseUrl,"/cards/").concat(e),{headers:this._headers,method:"DELETE"})}},{key:"changeLikeCardStatus",value:function(e,t){return j("".concat(this._baseUrl,"/cards/likes/").concat(e),{headers:this._headers,method:t?"PUT":"DELETE"})}}]),e}())({baseUrl:"https://api.cool-and-awesome.students.nomoreparties.sbs",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),m="https://api.cool-and-awesome.students.nomoreparties.sbs",h=n(0);var _=function(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),s=n[0],c=n[1],i=Object(a.useState)(""),r=Object(o.a)(i,2),p=r[0],d=r[1],b=Object(l.g)();return Object(a.useEffect)((function(){localStorage.getItem("token")&&b.push("/")}),[b]),Object(h.jsxs)("div",{className:"login register",children:[Object(h.jsx)("h2",{className:"login__title register__title",children:"Log in"}),Object(h.jsxs)("form",{onSubmit:function(t){t.preventDefault(),function(e,t){return j("".concat(m,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})}(s,p).then((function(t){if(!t||401===t.statusCode)throw new Error("Authorization failed!");t&&t.token&&(b.push("/"),localStorage.setItem("token",t.token),c(""),d(""),e.onSuccess(),e.handleLogin(),e.checkToken(),console.log(t.token))})).catch((function(t){e.handleError()}))},className:"login__form register__form",children:[Object(h.jsx)("input",{id:"email",required:!0,name:"email",className:"register__input",type:"email",value:s,onChange:function(e){return c(e.target.value)},placeholder:"Email"}),Object(h.jsx)("input",{id:"password",required:!0,name:"password",className:"register__input",type:"password",value:p,onChange:function(e){return d(e.target.value)},placeholder:"Password"}),Object(h.jsx)("button",{type:"submit",className:"login__link register__submit",children:"Log in"})]}),Object(h.jsxs)("p",{className:"register__signin",children:["Not a member yet?",Object(h.jsx)(u.b,{to:"/register",className:"login__register-link register__login-link",children:"  Sign up here!"})]})]})};function g(e){var t=Object(l.g)(),n=Object(a.useState)(""),s=Object(o.a)(n,2),c=s[0],i=s[1],r=Object(a.useState)(""),p=Object(o.a)(r,2),d=p[0],b=p[1];return Object(a.useEffect)((function(){localStorage.getItem("token")&&t.push("/")}),[t]),Object(h.jsxs)("div",{className:"register",children:[Object(h.jsx)("h2",{className:"register__title",children:"Sign up"}),Object(h.jsxs)("form",{className:"register__form",onSubmit:function(n){n.preventDefault(),function(e,t){return j("".concat(m,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})}(c,d).then((function(e){if(!e||400===e.statusCode)throw new Error("Oops, something went wrong! Please try again.")})).then((function(){e.onSuccess(),i(""),b(""),t.push("/login")})).catch((function(t){e.handleError()}))},children:[Object(h.jsx)("input",{required:!0,className:"register__input",name:"email",value:c,type:"email",onChange:function(e){return i(e.target.value)},placeholder:"Email"}),Object(h.jsx)("input",{required:!0,className:"register__input",name:"password",value:d,type:"password",onChange:function(e){return b(e.target.value)},placeholder:"Password"}),Object(h.jsx)("button",{type:"submit",className:"register__submit",children:"Sign up"})]}),Object(h.jsxs)("p",{className:"register__signin",children:["Already a member?",Object(h.jsx)(u.b,{to:"login",className:"register__login-link",children:"  Log in here!"})]})]})}var O=n(16),f=n(24),x=["isLoggedIn","children"],v=function(e){var t=e.isLoggedIn,n=e.children,a=Object(f.a)(e,x);return Object(h.jsx)(l.b,Object(O.a)(Object(O.a)({},a),{},{children:t?n:Object(h.jsx)(l.a,{to:"/login"})}))},C=n.p+"static/media/logo.4e8e0a1d.svg";var N=function(e){return Object(h.jsxs)("div",{className:"header",children:[Object(h.jsx)("img",{src:C,alt:"Around US logo",className:"header__logo"}),Object(h.jsxs)("div",{className:"header__user-status",children:[Object(h.jsx)("p",{className:"header__user-email",children:e.loggedUserEmail}),Object(h.jsx)(u.b,{to:e.path,className:"header__log-button",onClick:e.onLogClick,children:e.logText})]})]})};var S=function(){return Object(h.jsx)("div",{className:"footer",children:Object(h.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Around The U.S."})})},k=n.p+"static/media/VectorPen.8667ac4a.svg",y=n.p+"static/media/VectorPlus.d86bb2ed.svg",w=s.a.createContext(),E=n.p+"static/media/Trash.c4956c32.svg";var L=function(e){var t=s.a.useContext(w),n=e.ownerId===t._id,a=e.likes.some((function(e){return e===t._id}));return Object(h.jsxs)("div",{className:"place",children:[Object(h.jsx)("button",{type:"button",className:n?"place__delete":"place__delete_hidden",onClick:function(){e.onCardDelete(e.cardData)},children:Object(h.jsx)("img",{src:E,alt:"trash bin"})}),Object(h.jsx)("img",{className:"place__image",src:"".concat(e.link),alt:"user content cards",onClick:function(){e.onCardClick(e.cardData)}}),Object(h.jsxs)("div",{className:"place__description",children:[Object(h.jsx)("h2",{className:"place__title",children:e.name}),Object(h.jsxs)("div",{className:"place__like-box",children:[Object(h.jsx)("button",{type:"button",className:a?"place__like_active":"place__like",onClick:function(){e.onCardLike(e.cardData)}}),Object(h.jsx)("span",{className:"place__like-counter",children:e.likesCounter})]})]})]})};var T=function(e){var t=Object(a.useContext)(w);return Object(h.jsxs)("div",{className:"main-content",children:[Object(h.jsxs)("section",{className:"profile",children:[Object(h.jsxs)("button",{className:"profile__avatar-container",onClick:e.onEditAvatarClick,children:[Object(h.jsx)("img",{src:t.avatar,alt:"Avatar",className:"profile__image"}),Object(h.jsx)("div",{className:"profile__avatar-overlay",children:Object(h.jsx)("img",{src:k,alt:"pen",className:"profile__avatar-pen"})})]}),Object(h.jsxs)("div",{className:"profile__info",children:[Object(h.jsxs)("div",{className:"profile__name-line",children:[Object(h.jsx)("h1",{className:"profile__name",children:t.name}),Object(h.jsx)("button",{type:"button",className:"profile__edit-button",onClick:e.onEditProfileClick,children:Object(h.jsx)("img",{src:k,alt:"pen",className:"profile__edit-pen"})})]}),Object(h.jsx)("p",{className:"profile__about",children:t.about})]}),Object(h.jsx)("button",{type:"button",className:"profile__add-button",onClick:e.onAddPlaceClick,children:Object(h.jsx)("img",{src:y,alt:"plus",className:"profile__plus"})})]}),Object(h.jsx)("section",{className:"places",children:e.cards.map((function(t){return Object(h.jsx)(L,{cardData:t,link:t.link,name:t.name,likesCounter:t.likes.length,ownerId:t.owner,likes:t.likes,cardId:t._id,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete},t._id)}))})]})},U=n.p+"static/media/CloseIcon.1f0b5bb9.svg";var I=function(e){return Object(h.jsx)("div",{className:e.isOpen?"popup_active":"popup popup_type_picture",children:Object(h.jsxs)("figure",{className:"popup__pic-container",children:[Object(h.jsx)("button",{type:"button",className:"popup__closer",onClick:e.onClose,children:Object(h.jsx)("img",{src:U,alt:"Closing cross",className:"popup__x"})}),Object(h.jsx)("img",{src:e.fullViewLink,alt:"user's place",className:"popup__image"}),Object(h.jsx)("figcaption",{className:"popup__image-title",children:e.fullViewTitle})]})})};var A=function(e){return Object(h.jsx)("div",{className:e.isOpen?"popup_active":"popup popup_type_".concat(e.name),children:Object(h.jsxs)("div",{className:"popup__window",children:[Object(h.jsx)("h2",{className:"popup__title",children:e.title}),Object(h.jsx)("button",{type:"button",className:"popup__closer",onClick:e.onClose,children:Object(h.jsx)("img",{src:U,alt:"Closing cross",className:"popup__x"})}),Object(h.jsxs)("form",{className:"popup__form popup__form_type_".concat(e.name),onSubmit:e.onSubmit,children:[e.children,Object(h.jsx)("button",{type:"submit",className:"popup__submit",children:e.isSaving?"Saving...":e.submitButtonText})]})]})})};function P(e){var t=Object(a.useContext)(w),n=Object(a.useState)(""),s=Object(o.a)(n,2),c=s[0],i=s[1],r=Object(a.useState)(""),l=Object(o.a)(r,2),u=l[0],p=l[1];return Object(a.useEffect)((function(){i(t.name),p(t.about)}),[t,e.isOpen]),Object(h.jsxs)(A,{name:"edit",title:"Edit profile",submitButtonText:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:u})},isSaving:e.isSaving,children:[Object(h.jsx)("input",{id:"name-input",className:"popup__input popup__input_text_name",type:"text",name:"name",placeholder:"Jacques Cousteau",minLength:"2",maxLength:"40",required:!0,value:c||"",onChange:function(e){i(e.target.value)}}),Object(h.jsx)("span",{id:"name-input-error",className:"popup__error-message"}),Object(h.jsx)("input",{id:"profession-input",className:"popup__input popup__input_text_profession",type:"text",name:"profession",placeholder:"Explorer",minLength:"2",maxLength:"200",required:!0,value:u||"",onChange:function(e){p(e.target.value)}}),Object(h.jsx)("span",{id:"profession-input-error",className:"popup__error-message"})]})}function D(e){var t=Object(a.useRef)("");return Object(h.jsxs)(A,{name:"avatar",title:"Change profile picture",submitButtonText:"Save",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value})},isSaving:e.isSaving,children:[Object(h.jsx)("input",{ref:t,id:"image-url-input",className:"popup__input popup__input_text_link",type:"url",name:"avatar",placeholder:"https://somewebsite.com/someimage.jpg",required:!0}),Object(h.jsx)("span",{id:"image-url-input-error",className:"popup__error-message"})]})}function q(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),s=n[0],c=n[1],i=Object(a.useState)(""),r=Object(o.a)(i,2),l=r[0],u=r[1];return Object(a.useEffect)((function(){u(""),c("")}),[e.isOpen]),Object(h.jsxs)(A,{name:"add",title:"New place",submitButtonText:"Create",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlaceSubmit({link:s,name:l})},isSaving:e.isSaving,children:[Object(h.jsx)("input",{id:"toponym-input",className:"popup__input popup__input_text_toponym",type:"text",name:"name",placeholder:"Title",minLength:"1",maxLength:"30",value:l,required:!0,onChange:function(e){u(e.target.value)}}),Object(h.jsx)("span",{id:"toponym-input-error",className:"popup__error-message"}),Object(h.jsx)("input",{id:"url-input",className:"popup__input popup__input_text_link",type:"url",name:"link",placeholder:"Image URL",value:s,required:!0,onChange:function(e){c(e.target.value)}}),Object(h.jsx)("span",{id:"url-input-error",className:"popup__error-message"})]})}var B=n.p+"static/media/Check.1b6082f8.svg",J=n.p+"static/media/Oops.df8eddf6.svg";var V=function(e){return Object(h.jsx)("div",{className:e.isOpen?"popup_active":"popup",children:Object(h.jsxs)("div",{className:"popup__window",children:[Object(h.jsx)("button",{type:"button",className:"popup__closer",onClick:e.onClose,children:Object(h.jsx)("img",{src:U,alt:"Closing cross",className:"popup__x"})}),Object(h.jsx)("img",{src:e.isSuccessful?B:J,alt:"registration status icon",className:"popup__icon"}),Object(h.jsx)("p",{className:"popup__register-message",children:e.isSuccessful?"Success! You have now been registered.":"Oops, something went wrong! Please try again."})]})})};var F=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],s=t[1],c=Object(a.useState)(!1),i=Object(o.a)(c,2),u=i[0],p=i[1],d=Object(a.useState)(!1),O=Object(o.a)(d,2),f=O[0],x=O[1],C=Object(a.useState)(!1),k=Object(o.a)(C,2),y=k[0],E=k[1],L=Object(a.useState)([]),U=Object(o.a)(L,2),A=U[0],B=U[1],J=Object(a.useState)({}),F=Object(o.a)(J,2),z=F[0],H=F[1],R=Object(a.useState)({}),G=Object(o.a)(R,2),M=G[0],Y=G[1],K=Object(a.useState)(!1),Q=Object(o.a)(K,2),W=Q[0],X=Q[1],Z=Object(a.useState)(!1),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(null),ae=Object(o.a)(ne,2),se=ae[0],ce=ae[1],ie=Object(a.useState)(!1),re=Object(o.a)(ie,2),oe=re[0],le=re[1],ue=Object(a.useState)(!1),pe=Object(o.a)(ue,2),de=pe[0],je=pe[1],be=Object(l.g)(),me=Object(a.useCallback)((function(){var e=localStorage.getItem("token");e||(be.push("/login"),te(!1)),e&&function(e){return j("".concat(m,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})}(e).then((function(e){e&&(be.push("/"),te(!0),Y(e.data),ce(e.data.email),localStorage.setItem("currentUserId",e.data._id))})).catch((function(e){le(!1),he()}))}),[be]);function he(){je(!0)}function _e(){s(!1),p(!1),x(!1),E(!1),je(!1),H({})}return Object(a.useEffect)((function(){me()}),[me]),Object(a.useEffect)((function(){b.getInitialCards().then((function(e){B(e.data)})).catch((function(e){console.log("Server returned this error: ".concat(e.status))}))}),[]),Object(a.useEffect)((function(){var e=function(e){"Escape"===e.key&&_e()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]),Object(h.jsxs)("div",{className:"page-container",children:[Object(h.jsxs)(l.d,{children:[Object(h.jsxs)(l.b,{path:"/register",children:[Object(h.jsx)(N,{logText:"Log in",path:"/login"}),Object(h.jsx)(g,{handleError:function(){le(!1),he()},onSuccess:function(){le(!0),he()}})]}),Object(h.jsxs)(l.b,{path:"/login",children:[Object(h.jsx)(N,{logText:"Sign up",path:"/register"}),Object(h.jsx)(_,{onSuccess:function(){le(!0),he()},handleError:function(){le(!1),he()},checkToken:me,handleLogin:function(){te(!0)}})]}),Object(h.jsx)(w.Provider,{value:M,children:Object(h.jsxs)(v,{path:"/",isLoggedIn:ee,children:[Object(h.jsx)(N,{loggedUserEmail:se,logText:"Log out",path:"/login",onLogClick:function(){localStorage.clear(),be.push("/login"),te(!1),Y({}),_e()}}),Object(h.jsx)(T,{onEditAvatarClick:function(){x(!0)},onEditProfileClick:function(){s(!0)},onAddPlaceClick:function(){p(!0)},cards:A,onCardClick:function(e){H(e),E(!0)},onCardLike:function(e){var t=localStorage.getItem("currentUserId"),n=e.likes.some((function(e){return e===t}));b.changeLikeCardStatus(e._id,!n).then((function(t){B((function(n){return n.map((function(n){return n._id===e._id?t.data:n}))}))})).catch((function(e){console.log("Server returned this error:",e)}))},onCardDelete:function(e){b.deleteCard(e._id).then((function(){B(A.filter((function(t){return t._id!==e._id})))})).catch((function(e){console.log("Server returned this error:",e)}))}}),Object(h.jsx)(P,{isOpen:n,onClose:_e,onUpdateUser:function(e){X(!0),b.editUserInfo(e).then((function(e){Y(e.data),_e()})).catch((function(e){console.log("Server returned this error:",e)})).finally((function(){X(!1)}))},isSaving:W}),Object(h.jsx)(D,{isOpen:f,onClose:_e,onUpdateAvatar:function(e){X(!0),b.uploadUserAvatar(e).then((function(e){Y(e.data),_e()})).catch((function(e){console.log("Server returned this error:",e)})).finally((function(){X(!1)}))},isSaving:W}),Object(h.jsx)(q,{isOpen:u,onClose:_e,onAddPlaceSubmit:function(e){X(!0),b.postNewCard(e).then((function(e){B([e.data].concat(Object(r.a)(A))),_e()})).catch((function(e){console.log("Server returned this error:",e)})).finally((function(){X(!1)}))},isSaving:W}),Object(h.jsx)(I,{isOpen:y,onClose:_e,fullViewTitle:z.name,fullViewLink:z.link})]})}),Object(h.jsx)(l.b,{path:"/",children:ee?Object(h.jsx)(l.a,{to:"/"}):Object(h.jsx)(l.a,{to:"/login"})})]}),Object(h.jsx)(S,{}),Object(h.jsx)(V,{isOpen:de,isSuccessful:oe,onClose:_e})]})},z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),s(e),c(e),i(e)}))};i.a.render(Object(h.jsx)(s.a.StrictMode,{children:Object(h.jsx)(u.a,{children:Object(h.jsx)(F,{})})}),document.getElementById("root")),z()}},[[36,1,2]]]);
//# sourceMappingURL=main.a630d38c.chunk.js.map